---

- name: enable user list
  ansible.builtin.lineinfile:
    path: /etc/gdm3/greeter.dconf-defaults
    regexp: 'disable-user-list='
    line: "disable-user-list=false"
  notify: restart gdm

- name: hide users from login
  ansible.builtin.copy:
    dest: "/var/lib/AccountsService/users/{{ item }}"
    content: |
      [User]  
      Language=   
      XSession=gnome  
      SystemAccount=true
    loop: "{{ gdm_hidden_users }}"

- name: ensure vendor images path exists
  ansible.builtin.file:
    path: /usr/share/images/
    state: directory
    mode: '0755'
    owner: root
    group: root

- name: ensure login background image exists
  ansible.builtin.copy:
    src: kreuz_loginscreen.jpg
    dest: /usr/share/images/kreuz_loginscreen.jpg
    owner: root
    group: root
    mode: '0644'
  notify: restart gdm

- name: configure login background image
  ansible.builtin.lineinfile:
    path: /etc/gdm3/greeter.dconf-defaults
    regexp: 'picture-uri='
    line: "picture-uri='file:///usr/share/images/kreuz_loginscreen.jpg'"
  notify: restart gdm

- name: configure login background image
  ansible.builtin.lineinfile:
    path: /etc/gdm3/greeter.dconf-defaults
    regexp: 'picture-options='
    line: "picture-options='zoom'"
  notify: restart gdm

- name: enable login banner message
  ansible.builtin.lineinfile:
    path: /etc/gdm3/greeter.dconf-defaults
    regexp: 'banner-message-enable='
    line: "banner-message-enable=true"
  notify: restart gdm

- name: configure login banner message
  ansible.builtin.lineinfile:
    path: /etc/gdm3/greeter.dconf-defaults
    regexp: 'banner-message-text='
    line: "banner-message-text='HÃ¤rzlech Willkomme'"
  notify: restart gdm

